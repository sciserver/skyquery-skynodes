-- SUBSAMPLING TABLE 'PhotoObj' ---

 -- Create temporary table for the random ID list
 IF EXISTS( SELECT * FROM tempdb.dbo.sysobjects WHERE ID = OBJECT_ID(N'tempdb..##temporaryidlist'))
 DROP TABLE ##temporaryidlist;
 --GO

 CREATE TABLE ##temporaryidlist
 (
	[OBJID] bigint
 );
 
 -- Collect IDs
 WITH temporaryidlistquery AS
 (
	SELECT sourcetablealias.[OBJID], SkyQuery_Code.dbo.RandomDouble() AS randomnumber
	FROM [SkyNode_NDWFS].[dbo].[PhotoObj] sourcetablealias
	
 )
 INSERT ##temporaryidlist WITH (TABLOCKX)
 SELECT [OBJID]
 FROM temporaryidlistquery
 WHERE randomnumber < 0.01;
 
 -- Insert subset into destination table
 
 INSERT [SkyNode_NDWFS_Mini].[dbo].[PhotoObj] WITH (TABLOCKX)
	([OBJID], [BAND], [FIELD], [X_IMAGE], [Y_IMAGE], [XPEAK_IMAGE], [YPEAK_IMAGE], [NUMBER], [FLUX_ISO], [FLUXERR_ISO], [MAG_ISO], [MAGERR_ISO], [MAG_ISOCOR], [MAGERR_ISOCOR], [FLUX_APER_01], [FLUX_APER_02], [FLUX_APER_03], [FLUX_APER_04], [FLUX_APER_05], [FLUX_APER_06], [FLUX_APER_07], [FLUX_APER_08], [FLUX_APER_09], [FLUX_APER_10], [FLUX_APER_15], [FLUX_APER_20], [FLUXERR_APER_01], [FLUXERR_APER_02], [FLUXERR_APER_03], [FLUXERR_APER_04], [FLUXERR_APER_05], [FLUXERR_APER_06], [FLUXERR_APER_07], [FLUXERR_APER_08], [FLUXERR_APER_09], [FLUXERR_APER_10], [FLUXERR_APER_15], [FLUXERR_APER_20], [MAG_APER_01], [MAG_APER_02], [MAG_APER_03], [MAG_APER_04], [MAG_APER_05], [MAG_APER_06], [MAG_APER_07], [MAG_APER_08], [MAG_APER_09], [MAG_APER_10], [MAG_APER_15], [MAG_APER_20], [MAGERR_APER_01], [MAGERR_APER_02], [MAGERR_APER_03], [MAGERR_APER_04], [MAGERR_APER_05], [MAGERR_APER_06], [MAGERR_APER_07], [MAGERR_APER_08], [MAGERR_APER_09], [MAGERR_APER_10], [MAGERR_APER_15], [MAGERR_APER_20], [MAG_AUTO], [MAGERR_AUTO], [KRON_RADIUS], [BACKGROUND], [THRESHOLD], [FLUX_MAX], [ISOAREA_IMAGE], [RA], [DEC], [cx], [cy], [cz], [htmid], [ALPHAPEAK_J2000], [DELTAPEAK_J2000], [X2_IMAGE], [Y2_IMAGE], [XY_IMAGE], [CXX_IMAGE], [CYY_IMAGE], [CXY_IMAGE], [CXX_WORLD], [CYY_WORLD], [CXY_WORLD], [A_IMAGE], [B_IMAGE], [A_WORLD], [B_WORLD], [THETA_IMAGE], [THETA_WORLD], [ELONGATION], [ELLIPTICITY], [ERRX2_IMAGE], [ERRY2_IMAGE], [ERRXY_IMAGE], [ERRA_IMAGE], [ERRB_IMAGE], [ERRTHETA_IMAGE], [FWHM_IMAGE], [FLAGS], [IMAFLAGS_ISO], [CLASS_STAR])
 SELECT sourcetablealias.[OBJID], sourcetablealias.[BAND], sourcetablealias.[FIELD], sourcetablealias.[X_IMAGE], sourcetablealias.[Y_IMAGE], sourcetablealias.[XPEAK_IMAGE], sourcetablealias.[YPEAK_IMAGE], sourcetablealias.[NUMBER], sourcetablealias.[FLUX_ISO], sourcetablealias.[FLUXERR_ISO], sourcetablealias.[MAG_ISO], sourcetablealias.[MAGERR_ISO], sourcetablealias.[MAG_ISOCOR], sourcetablealias.[MAGERR_ISOCOR], sourcetablealias.[FLUX_APER_01], sourcetablealias.[FLUX_APER_02], sourcetablealias.[FLUX_APER_03], sourcetablealias.[FLUX_APER_04], sourcetablealias.[FLUX_APER_05], sourcetablealias.[FLUX_APER_06], sourcetablealias.[FLUX_APER_07], sourcetablealias.[FLUX_APER_08], sourcetablealias.[FLUX_APER_09], sourcetablealias.[FLUX_APER_10], sourcetablealias.[FLUX_APER_15], sourcetablealias.[FLUX_APER_20], sourcetablealias.[FLUXERR_APER_01], sourcetablealias.[FLUXERR_APER_02], sourcetablealias.[FLUXERR_APER_03], sourcetablealias.[FLUXERR_APER_04], sourcetablealias.[FLUXERR_APER_05], sourcetablealias.[FLUXERR_APER_06], sourcetablealias.[FLUXERR_APER_07], sourcetablealias.[FLUXERR_APER_08], sourcetablealias.[FLUXERR_APER_09], sourcetablealias.[FLUXERR_APER_10], sourcetablealias.[FLUXERR_APER_15], sourcetablealias.[FLUXERR_APER_20], sourcetablealias.[MAG_APER_01], sourcetablealias.[MAG_APER_02], sourcetablealias.[MAG_APER_03], sourcetablealias.[MAG_APER_04], sourcetablealias.[MAG_APER_05], sourcetablealias.[MAG_APER_06], sourcetablealias.[MAG_APER_07], sourcetablealias.[MAG_APER_08], sourcetablealias.[MAG_APER_09], sourcetablealias.[MAG_APER_10], sourcetablealias.[MAG_APER_15], sourcetablealias.[MAG_APER_20], sourcetablealias.[MAGERR_APER_01], sourcetablealias.[MAGERR_APER_02], sourcetablealias.[MAGERR_APER_03], sourcetablealias.[MAGERR_APER_04], sourcetablealias.[MAGERR_APER_05], sourcetablealias.[MAGERR_APER_06], sourcetablealias.[MAGERR_APER_07], sourcetablealias.[MAGERR_APER_08], sourcetablealias.[MAGERR_APER_09], sourcetablealias.[MAGERR_APER_10], sourcetablealias.[MAGERR_APER_15], sourcetablealias.[MAGERR_APER_20], sourcetablealias.[MAG_AUTO], sourcetablealias.[MAGERR_AUTO], sourcetablealias.[KRON_RADIUS], sourcetablealias.[BACKGROUND], sourcetablealias.[THRESHOLD], sourcetablealias.[FLUX_MAX], sourcetablealias.[ISOAREA_IMAGE], sourcetablealias.[RA], sourcetablealias.[DEC], sourcetablealias.[cx], sourcetablealias.[cy], sourcetablealias.[cz], sourcetablealias.[htmid], sourcetablealias.[ALPHAPEAK_J2000], sourcetablealias.[DELTAPEAK_J2000], sourcetablealias.[X2_IMAGE], sourcetablealias.[Y2_IMAGE], sourcetablealias.[XY_IMAGE], sourcetablealias.[CXX_IMAGE], sourcetablealias.[CYY_IMAGE], sourcetablealias.[CXY_IMAGE], sourcetablealias.[CXX_WORLD], sourcetablealias.[CYY_WORLD], sourcetablealias.[CXY_WORLD], sourcetablealias.[A_IMAGE], sourcetablealias.[B_IMAGE], sourcetablealias.[A_WORLD], sourcetablealias.[B_WORLD], sourcetablealias.[THETA_IMAGE], sourcetablealias.[THETA_WORLD], sourcetablealias.[ELONGATION], sourcetablealias.[ELLIPTICITY], sourcetablealias.[ERRX2_IMAGE], sourcetablealias.[ERRY2_IMAGE], sourcetablealias.[ERRXY_IMAGE], sourcetablealias.[ERRA_IMAGE], sourcetablealias.[ERRB_IMAGE], sourcetablealias.[ERRTHETA_IMAGE], sourcetablealias.[FWHM_IMAGE], sourcetablealias.[FLAGS], sourcetablealias.[IMAFLAGS_ISO], sourcetablealias.[CLASS_STAR]
 FROM   [SkyNode_NDWFS].[dbo].[PhotoObj] sourcetablealias WITH (NOLOCK)
	INNER JOIN ##temporaryidlist ON ##temporaryidlist.OBJID = sourcetablealias.OBJID
	;


GO

-- SUBSAMPLING TABLE 'PhotoObjK' ---

 -- Insert subset into destination table
 INSERT [SkyNode_NDWFS_Mini].[dbo].[PhotoObjK] WITH (TABLOCKX)
    ([OBJID], [BAND], [FIELD], [X_IMAGE], [Y_IMAGE], [XPEAK_IMAGE], [YPEAK_IMAGE], [NUMBER], [FLUX_ISO], [FLUXERR_ISO], [MAG_ISO], [MAGERR_ISO], [MAG_ISOCOR], [MAGERR_ISOCOR], [FLUX_APER_01], [FLUX_APER_02], [FLUX_APER_03], [FLUX_APER_04], [FLUX_APER_05], [FLUX_APER_06], [FLUX_APER_07], [FLUX_APER_08], [FLUX_APER_09], [FLUX_APER_10], [FLUX_APER_15], [FLUX_APER_20], [FLUXERR_APER_01], [FLUXERR_APER_02], [FLUXERR_APER_03], [FLUXERR_APER_04], [FLUXERR_APER_05], [FLUXERR_APER_06], [FLUXERR_APER_07], [FLUXERR_APER_08], [FLUXERR_APER_09], [FLUXERR_APER_10], [FLUXERR_APER_15], [FLUXERR_APER_20], [MAG_APER_01], [MAG_APER_02], [MAG_APER_03], [MAG_APER_04], [MAG_APER_05], [MAG_APER_06], [MAG_APER_07], [MAG_APER_08], [MAG_APER_09], [MAG_APER_10], [MAG_APER_15], [MAG_APER_20], [MAGERR_APER_01], [MAGERR_APER_02], [MAGERR_APER_03], [MAGERR_APER_04], [MAGERR_APER_05], [MAGERR_APER_06], [MAGERR_APER_07], [MAGERR_APER_08], [MAGERR_APER_09], [MAGERR_APER_10], [MAGERR_APER_15], [MAGERR_APER_20], [MAG_AUTO], [MAGERR_AUTO], [KRON_RADIUS], [BACKGROUND], [THRESHOLD], [FLUX_MAX], [ISOAREA_IMAGE], [RA], [DEC], [cx], [cy], [cz], [htmid], [ALPHAPEAK_J2000], [DELTAPEAK_J2000], [X2_IMAGE], [Y2_IMAGE], [XY_IMAGE], [CXX_IMAGE], [CYY_IMAGE], [CXY_IMAGE], [CXX_WORLD], [CYY_WORLD], [CXY_WORLD], [A_IMAGE], [B_IMAGE], [A_WORLD], [B_WORLD], [THETA_IMAGE], [THETA_WORLD], [ELONGATION], [ELLIPTICITY], [ERRX2_IMAGE], [ERRY2_IMAGE], [ERRXY_IMAGE], [ERRA_IMAGE], [ERRB_IMAGE], [ERRTHETA_IMAGE], [FWHM_IMAGE], [FLAGS], [IMAFLAGS_ISO], [CLASS_STAR])
 SELECT sourcetablealias.[OBJID], sourcetablealias.[BAND], sourcetablealias.[FIELD], sourcetablealias.[X_IMAGE], sourcetablealias.[Y_IMAGE], sourcetablealias.[XPEAK_IMAGE], sourcetablealias.[YPEAK_IMAGE], sourcetablealias.[NUMBER], sourcetablealias.[FLUX_ISO], sourcetablealias.[FLUXERR_ISO], sourcetablealias.[MAG_ISO], sourcetablealias.[MAGERR_ISO], sourcetablealias.[MAG_ISOCOR], sourcetablealias.[MAGERR_ISOCOR], sourcetablealias.[FLUX_APER_01], sourcetablealias.[FLUX_APER_02], sourcetablealias.[FLUX_APER_03], sourcetablealias.[FLUX_APER_04], sourcetablealias.[FLUX_APER_05], sourcetablealias.[FLUX_APER_06], sourcetablealias.[FLUX_APER_07], sourcetablealias.[FLUX_APER_08], sourcetablealias.[FLUX_APER_09], sourcetablealias.[FLUX_APER_10], sourcetablealias.[FLUX_APER_15], sourcetablealias.[FLUX_APER_20], sourcetablealias.[FLUXERR_APER_01], sourcetablealias.[FLUXERR_APER_02], sourcetablealias.[FLUXERR_APER_03], sourcetablealias.[FLUXERR_APER_04], sourcetablealias.[FLUXERR_APER_05], sourcetablealias.[FLUXERR_APER_06], sourcetablealias.[FLUXERR_APER_07], sourcetablealias.[FLUXERR_APER_08], sourcetablealias.[FLUXERR_APER_09], sourcetablealias.[FLUXERR_APER_10], sourcetablealias.[FLUXERR_APER_15], sourcetablealias.[FLUXERR_APER_20], sourcetablealias.[MAG_APER_01], sourcetablealias.[MAG_APER_02], sourcetablealias.[MAG_APER_03], sourcetablealias.[MAG_APER_04], sourcetablealias.[MAG_APER_05], sourcetablealias.[MAG_APER_06], sourcetablealias.[MAG_APER_07], sourcetablealias.[MAG_APER_08], sourcetablealias.[MAG_APER_09], sourcetablealias.[MAG_APER_10], sourcetablealias.[MAG_APER_15], sourcetablealias.[MAG_APER_20], sourcetablealias.[MAGERR_APER_01], sourcetablealias.[MAGERR_APER_02], sourcetablealias.[MAGERR_APER_03], sourcetablealias.[MAGERR_APER_04], sourcetablealias.[MAGERR_APER_05], sourcetablealias.[MAGERR_APER_06], sourcetablealias.[MAGERR_APER_07], sourcetablealias.[MAGERR_APER_08], sourcetablealias.[MAGERR_APER_09], sourcetablealias.[MAGERR_APER_10], sourcetablealias.[MAGERR_APER_15], sourcetablealias.[MAGERR_APER_20], sourcetablealias.[MAG_AUTO], sourcetablealias.[MAGERR_AUTO], sourcetablealias.[KRON_RADIUS], sourcetablealias.[BACKGROUND], sourcetablealias.[THRESHOLD], sourcetablealias.[FLUX_MAX], sourcetablealias.[ISOAREA_IMAGE], sourcetablealias.[RA], sourcetablealias.[DEC], sourcetablealias.[cx], sourcetablealias.[cy], sourcetablealias.[cz], sourcetablealias.[htmid], sourcetablealias.[ALPHAPEAK_J2000], sourcetablealias.[DELTAPEAK_J2000], sourcetablealias.[X2_IMAGE], sourcetablealias.[Y2_IMAGE], sourcetablealias.[XY_IMAGE], sourcetablealias.[CXX_IMAGE], sourcetablealias.[CYY_IMAGE], sourcetablealias.[CXY_IMAGE], sourcetablealias.[CXX_WORLD], sourcetablealias.[CYY_WORLD], sourcetablealias.[CXY_WORLD], sourcetablealias.[A_IMAGE], sourcetablealias.[B_IMAGE], sourcetablealias.[A_WORLD], sourcetablealias.[B_WORLD], sourcetablealias.[THETA_IMAGE], sourcetablealias.[THETA_WORLD], sourcetablealias.[ELONGATION], sourcetablealias.[ELLIPTICITY], sourcetablealias.[ERRX2_IMAGE], sourcetablealias.[ERRY2_IMAGE], sourcetablealias.[ERRXY_IMAGE], sourcetablealias.[ERRA_IMAGE], sourcetablealias.[ERRB_IMAGE], sourcetablealias.[ERRTHETA_IMAGE], sourcetablealias.[FWHM_IMAGE], sourcetablealias.[FLAGS], sourcetablealias.[IMAFLAGS_ISO], sourcetablealias.[CLASS_STAR]
 FROM   [SkyNode_NDWFS].[dbo].[PhotoObjK] sourcetablealias WITH (NOLOCK)
	;
 

GO

